

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7. Control Description Language &#8212; Control Description Language</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Code Generation" href="codeGeneration.html" />
    <link rel="prev" title="6. Software Architecture" href="softwareArchitecture.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/cdl-logo.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://obc.lbl.gov">Home</a></li>
                <li><a href="index.html">Table of Contents</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preample.html">1. Preamble</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preample.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">2. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">3. Process Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="useCases.html">4. Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#controls-design">4.1. Controls Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#bidding-and-bas-implementation">4.2. Bidding and BAS Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#commissioning-operation-and-maintenance">4.3. Commissioning, Operation, and Maintenance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">5. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#controls-design-tool">5.1. Controls Design Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#cdl">5.2. CDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#commissioning-and-functional-verification-tool">5.3. Commissioning and Functional Verification Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">6. Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#controls-design-tool">6.1. Controls Design Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#functional-verification-tool">6.2. Functional Verification Tool</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Control Description Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#syntax">7.1. Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#permissible-data-types">7.2. Permissible Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#encapsulation-of-functionality">7.3. Encapsulation of Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="#elementary-building-blocks">7.4. Elementary Building Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instantiation">7.5. Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connectors">7.6. Connectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#equations">7.7. Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connections">7.8. Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#annotations">7.9. Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#composite-blocks">7.10. Composite Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-of-computation">7.11. Model of Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tags">7.12. Tags</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="codeGeneration.html">8. Code Generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="codeGeneration.html#challenges-and-implications-for-translation-of-control-sequences">8.1. Challenges and Implications for Translation of Control Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="codeGeneration.html#use-of-control-sequences-or-verification-tests-in-realtime-applications">8.2. Use of Control Sequences or Verification Tests in Realtime Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="codeGeneration.html#replacement-of-elementary-cdl-blocks-during-translation">8.3. Replacement of Elementary CDL Blocks during Translation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="verification.html">9. Verification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="verification.html#scope-of-the-verification">9.1. Scope of the verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#methodology">9.2. Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#modules-of-the-verification-test">9.3. Modules of the verification test</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#example">9.4. Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">10. Example Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example.html#methodology">10.1. Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#performance-comparison">10.2. Performance comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#improvement-to-guideline-36-specification">10.3. Improvement to guideline 36 specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#discussion-and-conclusions">10.4. Discussion and conclusions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">11. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">12. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">13. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">7. Control Description Language</a><ul>
<li><a class="reference internal" href="#syntax">7.1. Syntax</a></li>
<li><a class="reference internal" href="#permissible-data-types">7.2. Permissible Data Types</a></li>
<li><a class="reference internal" href="#encapsulation-of-functionality">7.3. Encapsulation of Functionality</a></li>
<li><a class="reference internal" href="#elementary-building-blocks">7.4. Elementary Building Blocks</a></li>
<li><a class="reference internal" href="#instantiation">7.5. Instantiation</a></li>
<li><a class="reference internal" href="#connectors">7.6. Connectors</a></li>
<li><a class="reference internal" href="#equations">7.7. Equations</a></li>
<li><a class="reference internal" href="#connections">7.8. Connections</a></li>
<li><a class="reference internal" href="#annotations">7.9. Annotations</a></li>
<li><a class="reference internal" href="#composite-blocks">7.10. Composite Blocks</a></li>
<li><a class="reference internal" href="#model-of-computation">7.11. Model of Computation</a></li>
<li><a class="reference internal" href="#tags">7.12. Tags</a><ul>
<li><a class="reference internal" href="#inferred-properties">7.12.1. Inferred Properties</a></li>
<li><a class="reference internal" href="#tagged-properties">7.12.2. Tagged Properties</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="softwareArchitecture.html" title="Previous Chapter: 6. Software Architecture"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 6. Software A...</span>
    </a>
  </li>
  <li>
    <a href="codeGeneration.html" title="Next Chapter: 8. Code Generation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8. Code Generation &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="control-description-language">
<span id="sec-cdl"></span><h1>7. Control Description Language<a class="headerlink" href="#control-description-language" title="Permalink to this headline">¶</a></h1>
<p>This section specifies
the Control Description Language (CDL).</p>
<p>The CDL consists of the following elements:</p>
<ul class="simple">
<li>A list of elementary control blocks, such as a block that adds two signals and outputs the sum,
or a block that represents a PID controller.</li>
<li>Connectors through which these blocks receive values and output values.</li>
<li>Permissible data types.</li>
<li>Syntax to specify<ul>
<li>how to instantiate these blocks and assign values of parameters, such as a proportional gain.</li>
<li>how to connect inputs of blocks to outputs of other blocks.</li>
<li>how to document blocks.</li>
<li>how to add annotations such as for graphical rendering of blocks
and their connections.</li>
<li>how to specify composite blocks.</li>
</ul>
</li>
<li>A model of computation that describes when blocks are executed and when
outputs are assigned to inputs.</li>
</ul>
<p>The next sections explain the elements of CDL.</p>
<div class="section" id="syntax">
<h2>7.1. Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>In order to use CDL with building energy simulation programs,
and to not invent yet another language with new syntax, we use
a subset of the Modelica 3.3 specification
for the implementation of CDL <a class="reference internal" href="bibliography.html#modelica2012-1" id="id1">[Mod12]</a>.
The selected subset is needed to instantiate
classes, assign parameters, connect objects and document classes.
This subset is fully compatible with Modelica, e.g., no other information that
violates the Modelica Standard has been added, thereby allowing users
to view, modify and simulate CDL-conformant control sequences with any
Modelica-compliant simulation environment.</p>
<p>To simplify the support of CDL for tools and control systems,
the following Modelica keywords are not supported in CDL:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">extends</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">redeclare</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">constrainedby</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">inner</span></code> and <code class="docutils literal notranslate"><span class="pre">outer</span></code></li>
</ol>
<p>Also, the following Modelica language features are not supported in CDL:</p>
<ol class="arabic simple">
<li>Clocks [which are used in Modelica for hybrid system modeling].</li>
<li><code class="docutils literal notranslate"><span class="pre">algorithm</span></code> sections. [As the elementary building blocks are black-box
models as far as CDL is concerned and thus CDL compliant tools need
not parse the <code class="docutils literal notranslate"><span class="pre">algorithm</span></code> section.]</li>
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">equation</span></code> and <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">algorithm</span></code> sections.</li>
</ol>
</div>
<div class="section" id="permissible-data-types">
<span id="sec-cld-per-typ"></span><h2>7.2. Permissible Data Types<a class="headerlink" href="#permissible-data-types" title="Permalink to this headline">¶</a></h2>
<p>The basic data types are, in addition to the elementary building blocks,
parameters of type
<code class="docutils literal notranslate"><span class="pre">Real</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer</span></code>, <code class="docutils literal notranslate"><span class="pre">Boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">String</span></code>, and <code class="docutils literal notranslate"><span class="pre">enumeration</span></code>.
[Parameters do not change their value as time progress.]
See also the Modelica 3.3 specification, Chapter 3.
All specifications in CDL shall be declaration of blocks,
instances of blocks, or declarations of type <code class="docutils literal notranslate"><span class="pre">parameter</span></code>,
<code class="docutils literal notranslate"><span class="pre">constant</span></code>, or <code class="docutils literal notranslate"><span class="pre">enumeration</span></code>.
Variables are not allowed.
[Variables are used in the elementary building blocks,
but these can only be used as inputs to other blocks if they are declared
as an output.]</p>
<p>The declaration of such types is identical to the declaration
in Modelica.
[The keyword <code class="docutils literal notranslate"><span class="pre">parameter</span></code> is used
before the type declaration, and typically a graphical user interface
allows users to change the value of a parameter when the simulation
or control sequence is not running.
For example, to declare a real-valued parameter,
use <code class="docutils literal notranslate"><span class="pre">parameter</span> <span class="pre">Real</span> <span class="pre">k</span> <span class="pre">=</span> <span class="pre">1</span> <span class="pre">&quot;A</span> <span class="pre">parameter</span> <span class="pre">with</span> <span class="pre">value</span> <span class="pre">1&quot;;</span></code>.
In contrast, a <code class="docutils literal notranslate"><span class="pre">constant</span></code> cannot be changed after the software is
compiled, and is typically not shown in a graphical user interface menu.
For example, a <code class="docutils literal notranslate"><span class="pre">constant</span></code> is used to define latent heat of evaporation
if used in a controller.
]</p>
<p>Each of these data types, including the elementary building blocks,
can be a single instance or one-dimensional array.
Array indices shall be of type <code class="docutils literal notranslate"><span class="pre">Integer</span></code> only.
The first element of an array has index <code class="docutils literal notranslate"><span class="pre">1</span></code>.
An array of size <code class="docutils literal notranslate"><span class="pre">0</span></code> is an empty array.
See the Modelica 3.3 specification Chapter 10 for array notation.</p>
<p>[<code class="docutils literal notranslate"><span class="pre">enumeration</span></code> or <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> data types are not permitted as array indices.]</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We still need to define the allowed values for <code class="docutils literal notranslate"><span class="pre">quantity</span></code>, for example
<code class="docutils literal notranslate"><span class="pre">ThermodynamicTemperature</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Temp</span></code>.</p>
</div>
</div>
<div class="section" id="encapsulation-of-functionality">
<span id="sec-enc-block"></span><h2>7.3. Encapsulation of Functionality<a class="headerlink" href="#encapsulation-of-functionality" title="Permalink to this headline">¶</a></h2>
<p>All computations are encapsulated in a <code class="docutils literal notranslate"><span class="pre">block</span></code>.
Blocks expose parameters (used to configure
the block, such as a control gain), and they
expose inputs and outputs using <a class="reference internal" href="#connectors">connectors</a>.</p>
<p>Blocks are either <em>elementary building blocks</em> (<a class="reference internal" href="#sec-ele-bui-blo"><span class="std std-numref">Section 7.4</span></a>)
or <em>composite blocks</em> (<a class="reference internal" href="#sec-com-blo"><span class="std std-numref">Section 7.10</span></a>).</p>
</div>
<div class="section" id="elementary-building-blocks">
<span id="sec-ele-bui-blo"></span><h2>7.4. Elementary Building Blocks<a class="headerlink" href="#elementary-building-blocks" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id2">
<a class="reference internal image-reference" href="_images/cdl_screen_shot.png"><img alt="_images/cdl_screen_shot.png" src="_images/cdl_screen_shot.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-number">Fig. 7.1 </span><span class="caption-text">Screenshot of CDL library.</span></p>
</div>
<p>The CDL library contains elementary building blocks that are used to compose
control sequences.
The functionality of elementary building blocks, but not their implementation,
is part of the CDL specification.
Thus, in the most general form, elementary building blocks can be considered
as functions that for given parameters <span class="math notranslate nohighlight">\(p\)</span>,
time <span class="math notranslate nohighlight">\(t\)</span> and internal state <span class="math notranslate nohighlight">\(x(t)\)</span>,
map inputs <span class="math notranslate nohighlight">\(u(t)\)</span> to new values for the
outputs <span class="math notranslate nohighlight">\(y(t)\)</span> and states <span class="math notranslate nohighlight">\(x'(t)\)</span>, e.g.,</p>
<div class="math notranslate nohighlight">
\[(p, t, u(t), x(t)) \mapsto (y(t), x'(t)).\]</div>
<p>Control providers who support CDL need to be able to implement the same
functionality as is provided by the elementary CDL blocks.</p>
<p>[CDL implementations are allowed to use a different implementation of the elementary
building blocks, because the implementation is language specific. However,
implementations shall have the same inputs, outputs and parameters, and
they shall compute the same response for the same value of inputs and state variables.]</p>
<p>Users are not allowed to add
new elementary building blocks. Rather, users can use them to implement
composite blocks (<a class="reference internal" href="#sec-com-blo"><span class="std std-numref">Section 7.10</span></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The elementary building blocks can be browsed in any of these ways:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Open a web browser at
<a class="reference external" href="http://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Controls_OBC_CDL.html">http://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Controls_OBC_CDL.html</a>.</li>
<li>Download <a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/archive/master.zip">https://github.com/lbl-srg/modelica-buildings/archive/master.zip</a>, unzip the file,
and open <code class="docutils literal notranslate"><span class="pre">Buildings/package.mo</span></code> in the graphical model editor of
<a class="reference external" href="https://www.3ds.com/products-services/catia/products/dymola/trial-version/">Dymola</a> or
<a class="reference external" href="https://www.openmodelica.org/?id=78:omconnectioneditoromedit&amp;catid=10:main-category">OpenModelica</a>.
All models in the <cite>Examples</cite> and <cite>Validation</cite> packages can be simulated with these tools.
They can also be simulated with <a class="reference external" href="http://www.jmodelica.org/">JModelica</a>.</li>
</ul>
</div></blockquote>
</div>
<p>An actual implementation of an elementary building block
looks as follows, where we omitted the annotations that are
used for graphical rendering:</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">block</span> <span class="nc">AddParameter</span> <span class="s2">&quot;Output the sum of an input plus a parameter&quot;</span>

  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">p</span> <span class="s2">&quot;Value to be added&quot;</span><span class="p">;</span>

  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">k</span> <span class="s2">&quot;Gain of input&quot;</span><span class="p">;</span>

  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u</span> <span class="s2">&quot;Connector of Real input signal&quot;</span><span class="p">;</span>

  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">y</span> <span class="s2">&quot;Connector of Real output signal&quot;</span><span class="p">;</span>

<span class="kr">equation</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">p</span><span class="p">;</span>

  <span class="kr">annotation</span><span class="p">(</span><span class="n">Documentation</span><span class="p">(</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span>
<span class="s2">  </span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  Block that outputs <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>y = k u + p<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>,
  where <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>k<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> and <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>p<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> are
  parameters and <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>u<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> is an input.
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span><span class="s2">&quot;</span><span class="p">));</span>
<span class="kr">end</span> <span class="nc">AddParameter</span><span class="p">;</span>
</pre></div>
</div>
<p>For the complete implementation, see
the
<a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/blob/master/Buildings/Controls/OBC/CDL/Continuous/AddParameter.mo">github repository</a>.</p>
</div>
<div class="section" id="instantiation">
<span id="sec-instantiation"></span><h2>7.5. Instantiation<a class="headerlink" href="#instantiation" title="Permalink to this headline">¶</a></h2>
<p>Instantiation is identical to Modelica.</p>
<p>[For example, to instantiate a gain, one would write</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">Continuous</span><span class="o">.</span><span class="n">Gain</span> <span class="n">myGain</span><span class="p">(</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="s2">&quot;Constant gain of -1&quot;</span> <span class="kr">annotation</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<p>where the documentation string is optional.
The annotations is typically used
for the graphical positioning of the instance in a block-diagram.
]</p>
<p>In the assignment of <code class="docutils literal notranslate"><span class="pre">parameters</span></code>, calculations are allowed.</p>
<p>[For example, a hysteresis block could be configured as follows</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">pRel</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Pa&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="mi">50</span> <span class="s2">&quot;Pressure difference across damper&quot;</span><span class="p">;</span>

<span class="n">CDL</span><span class="o">.</span><span class="n">Logical</span><span class="o">.</span><span class="n">Hysteresis</span> <span class="n">hys</span><span class="p">(</span>
  <span class="n">uLow</span>  <span class="o">=</span> <span class="n">pRel</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span>
  <span class="n">uHigh</span> <span class="o">=</span> <span class="n">pRel</span><span class="o">+</span><span class="mi">25</span><span class="p">)</span> <span class="s2">&quot;Hysteresis for fan control&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>]</p>
<p>Instances can conditionally be removed by using an <code class="docutils literal notranslate"><span class="pre">if</span></code> clause.</p>
<p>[This allows to have one implementation for an economizer control sequence
that can be configured to take into account enthalpy rather than
temperature. An example code snippet is</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">parameter</span> <span class="nb">Boolean</span> <span class="n">use_enthalpy</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="s2">&quot;Set to true to evaluate outdoor air enthalpy in addition to temperature&quot;</span><span class="p">;</span>

<span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">hOut</span> <span class="kr">if</span> <span class="n">use_enthalpy</span>
   <span class="s2">&quot;Outdoor air enthalpy&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>By the Modelica language definition, all connections (<a class="reference internal" href="#sec-connections"><span class="std std-numref">Section 7.8</span></a>)
to <code class="docutils literal notranslate"><span class="pre">hOut</span></code> will be removed if <code class="docutils literal notranslate"><span class="pre">use_enthalpy</span> <span class="pre">=</span> <span class="pre">false</span></code>.]</p>
</div>
<div class="section" id="connectors">
<span id="sec-connectors"></span><h2>7.6. Connectors<a class="headerlink" href="#connectors" title="Permalink to this headline">¶</a></h2>
<p>Blocks expose their inputs and outputs through input and output
connectors.</p>
<p>The permissible connectors are implemented in the package
<code class="docutils literal notranslate"><span class="pre">CDL.Interfaces</span></code>, and are
<code class="docutils literal notranslate"><span class="pre">BooleanInput</span></code>, <code class="docutils literal notranslate"><span class="pre">BooleanOutput</span></code>,
<code class="docutils literal notranslate"><span class="pre">DayTypeInput</span></code>, <code class="docutils literal notranslate"><span class="pre">DayTypeOutput</span></code>,
<code class="docutils literal notranslate"><span class="pre">IntegerInput</span></code>, <code class="docutils literal notranslate"><span class="pre">IntegerOutput</span></code>,
<code class="docutils literal notranslate"><span class="pre">RealInput</span></code> and <code class="docutils literal notranslate"><span class="pre">RealOutput</span></code>.
<code class="docutils literal notranslate"><span class="pre">DayType</span></code> is an <code class="docutils literal notranslate"><span class="pre">enumeration</span></code> for working day,
non-working day and holiday.</p>
<p>Connectors can only carry scalar variables.
For arrays, the connectors need to be explicitly declared as an array.</p>
<p>[ For example, to declare an array of <code class="docutils literal notranslate"><span class="pre">nin</span></code> input signals, use</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">parameter</span> <span class="nb">Integer</span> <span class="n">nin</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="s2">&quot;Number of inputs&quot;</span><span class="p">;</span>

<span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u</span><span class="p">[</span><span class="n">nin</span><span class="p">]</span> <span class="s2">&quot;Connector for 2 Real input signals&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Hence, unlike in Modelica 3.3, we do not allow for automatic vectorization
of input signals.
]</p>
</div>
<div class="section" id="equations">
<span id="sec-equation"></span><h2>7.7. Equations<a class="headerlink" href="#equations" title="Permalink to this headline">¶</a></h2>
<p>After the instantiations (<a class="reference internal" href="#sec-instantiation"><span class="std std-numref">Section 7.5</span></a>),
a keyword <code class="docutils literal notranslate"><span class="pre">equation</span></code> must be present
to introduce the equation section.
The equation section can only contain
connections (<a class="reference internal" href="#sec-connections"><span class="std std-numref">Section 7.8</span></a>) and
annotations (<a class="reference internal" href="#sec-annotations"><span class="std std-numref">Section 7.9</span></a>).</p>
<p>Unlike in Modelica, an <code class="docutils literal notranslate"><span class="pre">equation</span></code> section shall not contain
equations such as <code class="docutils literal notranslate"><span class="pre">y=2*u;</span></code> or commands such as <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">if</span></code>,
<code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">when</span></code>.</p>
<p>Furthermore, unlike in Modelica, there shall not be an <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">equation</span></code>,
<code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">algorithm</span></code> or <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>
section. (They can however be part of a elementary building block.)</p>
</div>
<div class="section" id="connections">
<span id="sec-connections"></span><h2>7.8. Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h2>
<p>Connections connect input to output connector (<a class="reference internal" href="#sec-connectors"><span class="std std-numref">Section 7.6</span></a>).
For scalar connectors, each input connector of a block needs to be connected to exactly
one output connector of a block.
For vectorized connectors, each (element of an) input connector needs to be connected
to exactly one (element of an) output connector.
Vectorized input connectors can be connected to vectorized output connectors
using one connection statement provided that
they have the same number of elements.</p>
<p>Connections are listed after the instantiation of the blocks in an <code class="docutils literal notranslate"><span class="pre">equation</span></code>
section. The syntax is</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">connect</span><span class="p">(</span><span class="n">port_a</span><span class="p">,</span> <span class="n">port_b</span><span class="p">)</span> <span class="kr">annotation</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">annotation(...)</span></code> is used to declare
the graphical rendering of the connection (see <a class="reference internal" href="#sec-annotations"><span class="std std-numref">Section 7.9</span></a>).
The order of the connections and the order of the arguments in the
<code class="docutils literal notranslate"><span class="pre">connect</span></code> statement does not matter.</p>
<p>[For example, to connect an input <code class="docutils literal notranslate"><span class="pre">u</span></code> of an instance <code class="docutils literal notranslate"><span class="pre">gain</span></code> to the output
<code class="docutils literal notranslate"><span class="pre">y</span></code> of an instance <code class="docutils literal notranslate"><span class="pre">maxValue</span></code>, one would declare</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">Continuous</span><span class="o">.</span><span class="n">Max</span> <span class="n">maxValue</span> <span class="s2">&quot;Output maximum value&quot;</span><span class="p">;</span>
<span class="n">Continous</span><span class="o">.</span><span class="n">Gain</span> <span class="n">gain</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="s2">&quot;Gain&quot;</span><span class="p">;</span>

<span class="kr">equation</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">gain</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">.</span><span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>]</p>
<p>Signals shall be connected using a <code class="docutils literal notranslate"><span class="pre">connect</span></code> statement;
assigning the value of a signal in the instantiation of the
output connnector is not allowed.</p>
<p>[This ensures that all control sequences are expressed as block diagrams.
For example, the following model is valid</p>
<div class="highlight-modelica notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">block</span> <span class="nc">MyAdderValid</span>
  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u1</span><span class="p">;</span>
  <span class="n">RealInput</span> <span class="n">u2</span><span class="p">;</span>
  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">Continuous</span><span class="o">.</span><span class="n">Add</span> <span class="n">add</span><span class="p">;</span>
<span class="kr">equation</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">u1</span><span class="p">);</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">u2</span><span class="p">,</span> <span class="n">u2</span><span class="p">);</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">y</span><span class="p">);</span>
<span class="kr">end</span> <span class="nc">MyAdderValid</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>whereas the following implementation is not valid in CDL, although it is valid in Modelica</p>
<div class="highlight-modelica notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">block</span> <span class="nc">MyAdderInvalid</span>
  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u1</span><span class="p">;</span>
  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u2</span><span class="p">;</span>
<span class="hll">  <span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">y</span> <span class="o">=</span> <span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="p">;</span> <span class="c1">// not allowed</span>
</span><span class="kr">end</span> <span class="nc">MyAdderInvalid</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>]</p>
</div>
<div class="section" id="annotations">
<span id="sec-annotations"></span><h2>7.9. Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h2>
<p>Annotations follow the same rules as described in the following
Modelica 3.3 Specifications</p>
<ul class="simple">
<li>18.2 Annotations for Documentation</li>
<li>18.6 Annotations for Graphical Objects, with the exception of<ul>
<li>18.6.7 User input</li>
</ul>
</li>
<li>18.8 Annotations for Version Handling</li>
</ul>
<p>[For CDL, annotations are primarily used to graphically visualize block layouts, graphically visualize
input and output signal connections, and to declare
vendor annotations (Sec. 18.1 in Modelica 3.3 Specification).]</p>
</div>
<div class="section" id="composite-blocks">
<span id="sec-com-blo"></span><h2>7.10. Composite Blocks<a class="headerlink" href="#composite-blocks" title="Permalink to this headline">¶</a></h2>
<p>CDL allows building composite blocks such as shown in
<a class="reference internal" href="#fig-custom-control-block"><span class="std std-numref">Fig. 7.2</span></a>.</p>
<div class="figure" id="id3">
<span id="fig-custom-control-block"></span><a class="reference internal image-reference" href="_images/CustomPWithLimiter.svg"><img alt="_images/CustomPWithLimiter.svg" src="_images/CustomPWithLimiter.svg" width="500px" /></a>
<p class="caption"><span class="caption-number">Fig. 7.2 </span><span class="caption-text">Example of a composite control block that outputs <span class="math notranslate nohighlight">\(y = \min( k \, e, \, y_{max})\)</span>
where <span class="math notranslate nohighlight">\(k\)</span> is a parameter.</span></p>
</div>
<p>Composite blocks can contain other composite blocks.</p>
<p>Each composite block shall be stored on the file system under the name of the composite block
with the file extension <code class="docutils literal notranslate"><span class="pre">.mo</span></code>, and with each package name being a directory.
The name shall be an allowed Modelica class name.</p>
<p>[For example, if a user specifies a new composite block <code class="docutils literal notranslate"><span class="pre">MyController.MyAdder</span></code>, then it
shall be stored in the file <code class="docutils literal notranslate"><span class="pre">MyController/MyAdder.mo</span></code> on Linux or OS X, or <code class="docutils literal notranslate"><span class="pre">MyController\\MyAdder.mo</span></code>
on Windows.]</p>
<p>[The following statement, when saved as <code class="docutils literal notranslate"><span class="pre">CustomPWithLimiter.mo</span></code>, is the
declaration of the composite block shown in <a class="reference internal" href="#fig-custom-control-block"><span class="std std-numref">Fig. 7.2</span></a></p>
<div class="highlight-modelica notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">block</span> <span class="nc">CustomPWithLimiter</span>
  <span class="s2">&quot;Custom implementation of a P controller with variable output limiter&quot;</span>

  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">k</span> <span class="s2">&quot;Constant gain&quot;</span><span class="p">;</span>

  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">yMax</span> <span class="s2">&quot;Maximum value of output signal&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span><span class="mi">20</span><span class="p">},{</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">60</span><span class="p">}})));</span>

  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">e</span> <span class="s2">&quot;Control error&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">},{</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">}})));</span>

  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">y</span> <span class="s2">&quot;Control signal&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="mi">120</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>

  <span class="n">CDL</span><span class="o">.</span><span class="n">Continuous</span><span class="o">.</span><span class="n">Gain</span> <span class="n">gain</span><span class="p">(</span><span class="kr">final</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="s2">&quot;Constant gain&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="o">-</span><span class="mi">50</span><span class="p">},{</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">}})));</span>

  <span class="n">CDL</span><span class="o">.</span><span class="n">Continuous</span><span class="o">.</span><span class="n">Min</span> <span class="n">minValue</span> <span class="s2">&quot;Outputs the minimum of its inputs&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="mi">40</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>
<span class="kr">equation</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">yMax</span><span class="p">,</span> <span class="n">minValue</span><span class="o">.</span><span class="n">u1</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">},{</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">}},</span>
         <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">gain</span><span class="o">.</span><span class="n">u</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">92</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">62</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">}},</span>
         <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">gain</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">minValue</span><span class="o">.</span><span class="n">u2</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">39</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="mi">18</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">}},</span>
         <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">minValue</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
     <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="mi">41</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">110</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span>
          <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>

  <span class="kr">annotation</span> <span class="p">(</span><span class="n">Documentation</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="s2">&quot;</span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
Block that outputs <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>y = min(yMax, k*e)<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>,
where
<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>yMax<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> and <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>e<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> are real-valued input signals and
<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>k<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> is a parameter.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span><span class="s2">&quot;</span><span class="p">));</span>
<span class="kr">end</span> <span class="nc">CustomPWithLimiter</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Composite blocks are needed to preserve grouping of control blocks and their connections,
and are needed for hierarchical composition of control sequences.]</p>
</div>
<div class="section" id="model-of-computation">
<h2>7.11. Model of Computation<a class="headerlink" href="#model-of-computation" title="Permalink to this headline">¶</a></h2>
<p>CDL uses the synchronous data flow principle and the single assignment rule,
which are defined below. [The definition is adopted from and consistent with the Modelica 3.3 Specification, Section 8.4.]</p>
<ol class="arabic simple">
<li>All variables keep their actual values until these values
are explicitly changed. Variable values can be accessed at any time instant.</li>
<li>Computation and communication at an event instant does not take time.
[If computation or communication time has to be simulated, this property has to be explicitly modeled.]</li>
<li>Every input connector shall be connected to exactly one output connector.</li>
</ol>
<p>In addition, the dependency graph from inputs to outputs that directly depend
on inputs shall be directed and acyclic.
I.e., connections that form an algebraic loop are not allowed.
[To break an algebraic loop, one could place a delay block or an integrator
in the loop, because the outputs of a delay or integrator does <em>not</em> depend
directly on the input.]</p>
</div>
<div class="section" id="tags">
<h2>7.12. Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h2>
<p>CDL has sufficient information for tools that process CDL to
generate for example point lists that list all analog temperature sensors,
or to verify that a pressure control signal is not connected to a temperature
input of a controller.
Some, but not all, of this information can be inferred from the CDL language described above.
We will use tags, implemented through Modelica vendor annotations,
to provide this additional information.
In <a class="reference internal" href="#sec-inf-pro"><span class="std std-numref">Section 7.12.1</span></a>, we will explain the properties that can be inferred,
and in <a class="reference internal" href="#sec-tag-pro"><span class="std std-numref">Section 7.12.2</span></a>, we will explain how to use
tagging schemes in CDL.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">None of this information affects the computation of a control signal.
Rather, it can be used for example to facilitate the implementation of cost estimation tools,
or to detect incorrect connections between outputs and inputs.</p>
</div>
<div class="section" id="inferred-properties">
<span id="sec-inf-pro"></span><h3>7.12.1. Inferred Properties<a class="headerlink" href="#inferred-properties" title="Permalink to this headline">¶</a></h3>
<p>To avoid that signals with physically incompatible quantities
are connected, tools that parse CDL can infer the physical quantities
from the <code class="docutils literal notranslate"><span class="pre">unit</span></code> and <code class="docutils literal notranslate"><span class="pre">quantity</span></code> attributes.</p>
<p>[For example, a differential pressure input signal with name <code class="docutils literal notranslate"><span class="pre">u</span></code>
can be declared as</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">u</span><span class="p">(</span>
  <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;PressureDifference&quot;</span><span class="p">,</span>
  <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Pa&quot;</span><span class="p">)</span> <span class="s2">&quot;Differential pressure signal&quot;</span> <span class="kr">annotation</span> <span class="p">(</span><span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<p>Hence, tools can verify that the <code class="docutils literal notranslate"><span class="pre">PressureDifference</span></code> is not connected
to <code class="docutils literal notranslate"><span class="pre">AbsolutePressure</span></code>, and they can infer that the input has units of Pascal.</p>
<p>Therefore, tools that process CDL can infer the following information:</p>
<ul class="simple">
<li>Numerical value:
<a class="reference internal" href="glossary.html#term-binary-value"><span class="xref std std-term">Binary value</span></a>
(which in CDL is represented by a <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> data type),
<a class="reference internal" href="glossary.html#term-analog-value"><span class="xref std std-term">analog value</span></a>,
(which in CDL is represented by a <code class="docutils literal notranslate"><span class="pre">Real</span></code> data type)
<a class="reference internal" href="glossary.html#term-mode"><span class="xref std std-term">mode</span></a>
(which in CDL is presented by an <code class="docutils literal notranslate"><span class="pre">Integer</span></code> data type or an enumeration,
which allow for example encoding of the
ASHRAE Guideline 36 Freeze Protection which has 4 stages).</li>
<li>Source: Hardware point or software point.</li>
<li>Quantity: such as Temperature, Pressure, Humidity or Speed.</li>
<li>Unit: Unit and preferred display unit. (The display unit
can be overwritten by a tool. This allows for example a control vendor
to use the same sequences in North America displaying IP units, and in
the rest of the world displaying SI units.)</li>
</ul>
<p>]</p>
</div>
<div class="section" id="tagged-properties">
<span id="sec-tag-pro"></span><h3>7.12.2. Tagged Properties<a class="headerlink" href="#tagged-properties" title="Permalink to this headline">¶</a></h3>
<p>The buildings industry uses different tagging schemes such as
Brick (<a class="reference external" href="http://brickschema.org/">http://brickschema.org/</a>) and Haystack (<a class="reference external" href="http://project-haystack.org/">http://project-haystack.org/</a>).
CDL allows, but does not require, use of the Brick or Haystack tagging scheme.</p>
<p>CDL allows to add tags to declarations that instantiate</p>
<ul class="simple">
<li>elementary building blocks (<a class="reference internal" href="#sec-ele-bui-blo"><span class="std std-numref">Section 7.4</span></a>), and</li>
<li>composite blocks (<a class="reference internal" href="#sec-com-blo"><span class="std std-numref">Section 7.10</span></a>).</li>
</ul>
<p>[We currently do not see a use case that would require
adding a tag to a <code class="docutils literal notranslate"><span class="pre">parameter</span></code> declaration.]</p>
<p>To implement such tags, CDL blocks can contain
vendor annotations with the following syntax:</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">annotation</span> <span class="o">:</span>
  <span class="kr">annotation</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span><span class="n">annotations</span> <span class="s2">&quot;,&quot;</span><span class="p">]</span>
     <span class="n">__cdl</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span> <span class="n">__cdl_annotation</span> <span class="p">]</span> <span class="s2">&quot;)&quot;</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span> <span class="n">annotations</span><span class="p">]</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">__cdl__annotation</span></code> is the annotation for CDL.</p>
<p>For Brick, the <code class="docutils literal notranslate"><span class="pre">__cdl_annotation</span></code> is</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">brick_annotation</span><span class="o">:</span>
   <span class="n">brick</span> <span class="s2">&quot;(&quot;</span> <span class="n">RDF</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">RDF</span></code> is the RDF 1.1 Turtle
(<a class="reference external" href="https://www.w3.org/TR/turtle/">https://www.w3.org/TR/turtle/</a>) specification of the Brick object.</p>
<p>[Note that, for example
for a controller with two output signals <span class="math notranslate nohighlight">\(y_1\)</span> and <span class="math notranslate nohighlight">\(y_2\)</span>,
Brick seems to have no means to specify
that <span class="math notranslate nohighlight">\(y_1\)</span> <code class="docutils literal notranslate"><span class="pre">controls</span></code> a fan speed and <span class="math notranslate nohighlight">\(y_2\)</span> <code class="docutils literal notranslate"><span class="pre">controls</span></code>
a heating valve, where <code class="docutils literal notranslate"><span class="pre">controls</span></code> is the Brick relationship.
Therefore, we allow the <code class="docutils literal notranslate"><span class="pre">brick_annotation</span></code> to only be at the
block level, but not at the level of instances of input or output
connectors.</p>
<p>For example, the Brick specification</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">soda_hall</span><span class="o">:</span><span class="n">flow_sensor_SODA1F1_VAV_AV</span> <span class="n">a</span> <span class="n">brick</span><span class="o">:</span><span class="n">Supply_Air_Flow_Sensor</span> <span class="p">;</span>
   <span class="n">bf</span><span class="o">:</span><span class="n">hasTag</span> <span class="n">brick</span><span class="o">:</span><span class="n">Average</span> <span class="p">;</span>
   <span class="n">bf</span><span class="o">:</span><span class="n">isLocatedIn</span> <span class="n">soda_hall</span><span class="o">:</span><span class="n">floor_1</span> <span class="o">.</span>
</pre></div>
</div>
<p>can be declared in CDL as</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">annotation</span><span class="p">(</span><span class="n">__cdl</span><span class="p">(</span><span class="n">brick</span><span class="o">=</span><span class="s2">&quot;soda_hall:flow_sensor_SODA1F1_VAV_AV a brick:Supply_Air_Flow_Sensor  ;</span>
<span class="s2">  bf:hasTag brick:Average ;</span>
<span class="s2">  bf:isLocatedIn soda_hall:floor_1 .&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>]</p>
<p>For Haystack, the <code class="docutils literal notranslate"><span class="pre">__cdl_annotation</span></code> is</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">haystack_annotation</span><span class="o">:</span>
   <span class="n">haystack</span> <span class="s2">&quot;(&quot;</span> <span class="n">JSON</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">JSON</span></code> is the JSON encoding of the Haystack object.</p>
<p>[For example, the AHU discharge air temperature setpoint of the example
in <a class="reference external" href="http://project-haystack.org/tag/sensor">http://project-haystack.org/tag/sensor</a>, which is in Haystack declared as</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">:</span> <span class="nd">@whitehouse</span><span class="o">.</span><span class="n">ahu3</span><span class="o">.</span><span class="n">dat</span>
<span class="n">dis</span><span class="p">:</span> <span class="s2">&quot;White House AHU-3 DischargeAirTemp&quot;</span>
<span class="n">point</span>
<span class="n">siteRef</span><span class="p">:</span> <span class="nd">@whitehouse</span>
<span class="n">equipRef</span><span class="p">:</span> <span class="nd">@whitehouse</span><span class="o">.</span><span class="n">ahu3</span>
<span class="n">discharge</span>
<span class="n">air</span>
<span class="n">temp</span>
<span class="n">sensor</span>
<span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;Number&quot;</span>
<span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;degF&quot;</span>
</pre></div>
</div>
<p>can be declared in CDL as</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annotation</span><span class="p">(</span><span class="n">__cdl</span><span class="p">(</span> <span class="n">haystack</span><span class="o">=</span>
  <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">id</span><span class="se">\&quot;</span><span class="s2">   : </span><span class="se">\&quot;</span><span class="s2">@whitehouse.ahu3.dat</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;dis</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">White House AHU-3 DischargeAirTemp</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;point</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">m:</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;siteRef</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">@whitehouse</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;equipRef</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">@whitehouse.ahu3</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;discharge</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">m:</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;air</span><span class="se">\&quot;</span><span class="s2">       : </span><span class="se">\&quot;</span><span class="s2">m:</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;temp</span><span class="se">\&quot;</span><span class="s2">      : </span><span class="se">\&quot;</span><span class="s2">m:</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;sensor</span><span class="se">\&quot;</span><span class="s2">    : </span><span class="se">\&quot;</span><span class="s2">m:</span><span class="se">\&quot;</span><span class="s2">,</span>
    \<span class="s2">&quot;kind</span><span class="se">\&quot;</span><span class="s2">       : </span><span class="se">\&quot;</span><span class="s2">Number</span><span class="se">\&quot;</span>
    \<span class="s2">&quot;unit</span><span class="se">\&quot;</span><span class="s2">       : </span><span class="se">\&quot;</span><span class="s2">degF</span><span class="se">\&quot;</span><span class="s2">}&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>Tools that process CDL can interpret the <code class="docutils literal notranslate"><span class="pre">brick</span></code> or <code class="docutils literal notranslate"><span class="pre">haystack</span></code> annotation,
but for control purposes CDL will ignore it. [This avoids potential conflict for entities that
are declared differently in Brick (or Haystack) and CDL, and may be conflicting.
For example, the above sensor input declares in Haystack that it belongs
to an ahu3. CDL, however, has a different syntax to declare such dependencies:
In CDL, through the <code class="docutils literal notranslate"><span class="pre">connect(whitehouse.ahu3.TSup,</span> <span class="pre">...)</span></code> statement,
a tool can infer what upstream component sends the input signal.]</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.<br/>
    </p>
  </div>
</footer>

  </body>
</html>