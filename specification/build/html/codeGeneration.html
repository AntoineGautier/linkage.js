

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>8. Code Generation &#8212; Control Description Language</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. Verification" href="verification.html" />
    <link rel="prev" title="7. Control Description Language" href="cdl.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/cdl-logo.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://obc.lbl.gov">Home</a></li>
                <li><a href="index.html">Table of Contents</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preample.html">1. Preamble</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preample.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">2. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">3. Process Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="useCases.html">4. Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#controls-design">4.1. Controls Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#bidding-and-bas-implementation">4.2. Bidding and BAS Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#commissioning-operation-and-maintenance">4.3. Commissioning, Operation, and Maintenance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">5. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#controls-design-tool">5.1. Controls Design Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#cdl">5.2. CDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#commissioning-and-functional-verification-tool">5.3. Commissioning and Functional Verification Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">6. Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#controls-design-tool">6.1. Controls Design Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#functional-verification-tool">6.2. Functional Verification Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdl.html">7. Control Description Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#syntax">7.1. Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#permissible-data-types">7.2. Permissible Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#encapsulation-of-functionality">7.3. Encapsulation of Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#elementary-building-blocks">7.4. Elementary Building Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#instantiation">7.5. Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#connectors">7.6. Connectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#equations">7.7. Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#connections">7.8. Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#annotations">7.9. Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#composite-blocks">7.10. Composite Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#model-of-computation">7.11. Model of Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdl.html#tags">7.12. Tags</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Code Generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#challenges-and-implications-for-translation-of-control-sequences">8.1. Challenges and Implications for Translation of Control Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-of-control-sequences-or-verification-tests-in-realtime-applications">8.2. Use of Control Sequences or Verification Tests in Realtime Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replacement-of-elementary-cdl-blocks-during-translation">8.3. Replacement of Elementary CDL Blocks during Translation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="verification.html">9. Verification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="verification.html#scope-of-the-verification">9.1. Scope of the verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#methodology">9.2. Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#modules-of-the-verification-test">9.3. Modules of the verification test</a></li>
<li class="toctree-l2"><a class="reference internal" href="verification.html#example">9.4. Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">10. Example Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example.html#methodology">10.1. Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#performance-comparison">10.2. Performance comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#improvement-to-guideline-36-specification">10.3. Improvement to guideline 36 specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html#discussion-and-conclusions">10.4. Discussion and conclusions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">11. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">12. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">13. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">8. Code Generation</a><ul>
<li><a class="reference internal" href="#challenges-and-implications-for-translation-of-control-sequences">8.1. Challenges and Implications for Translation of Control Sequences</a></li>
<li><a class="reference internal" href="#use-of-control-sequences-or-verification-tests-in-realtime-applications">8.2. Use of Control Sequences or Verification Tests in Realtime Applications</a><ul>
<li><a class="reference internal" href="#export-of-a-control-sequence-or-a-verification-test-using-the-fmi-standard">8.2.1. Export of a Control Sequence or a Verification Test using the FMI Standard</a></li>
<li><a class="reference internal" href="#translation-of-a-control-sequence-using-a-json-intermediate-format">8.2.2. Translation of a Control Sequence using a JSON Intermediate Format</a></li>
<li><a class="reference internal" href="#modular-export-of-a-control-sequence-using-the-fmi-standard-for-control-blocks-and-using-the-ssp-standard-for-the-run-time-environment">8.2.3. Modular Export of a Control Sequence using the FMI Standard for Control Blocks and using the SSP Standard for the Run-time Environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#replacement-of-elementary-cdl-blocks-during-translation">8.3. Replacement of Elementary CDL Blocks during Translation</a><ul>
<li><a class="reference internal" href="#substitutions-that-give-identical-control-response">8.3.1. Substitutions that Give Identical Control Response</a></li>
<li><a class="reference internal" href="#substitutions-that-change-the-control-response">8.3.2. Substitutions that Change the Control Response</a></li>
<li><a class="reference internal" href="#adding-blocks-that-are-not-in-the-cdl-library">8.3.3. Adding Blocks that are not in the CDL Library</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="cdl.html" title="Previous Chapter: 7. Control Description Language"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 7. Control De...</span>
    </a>
  </li>
  <li>
    <a href="verification.html" title="Next Chapter: 9. Verification"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">9. Verification &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="code-generation">
<span id="sec-code-gen"></span><h1>8. Code Generation<a class="headerlink" href="#code-generation" title="Permalink to this headline">¶</a></h1>
<p>This section describes the development of a proof-of-concept
translator from CDL to a building automation system.
Translating the <em>CDL library</em> to a building automation system needs to be done only when
the CDL library is updated, and hence only developers need
to perform this step.
However, translation of a <em>CDL-conforming control sequence</em>, as well as translation
of verification tests, will need to be done for each building project.</p>
<div class="section" id="challenges-and-implications-for-translation-of-control-sequences">
<h2>8.1. Challenges and Implications for Translation of Control Sequences<a class="headerlink" href="#challenges-and-implications-for-translation-of-control-sequences" title="Permalink to this headline">¶</a></h2>
<p>This section discusses challenges and implications
for translating CDL-conforming control
sequences to executable code on a building automation system.</p>
<p>First, we note that the translation will for most, if not all,
systems only be possible from CDL to a building automation system,
but not vice versa. This is due to specific constructs that may exist
in building automation systems but not in CDL.  For example,
if Sedona were the target platform, then
translating from Sedona to CDL will not be possible
because Sedona allows boolean variables
to take on the values <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> and <code class="docutils literal notranslate"><span class="pre">null</span></code>, but
CDL has no <code class="docutils literal notranslate"><span class="pre">null</span></code> value.</p>
<p>Second, we note that most building automation product lines are based on
old computing technologies. One may argue that to meet future process
requirements and user-friendliness, these may be updated in the near future.
Relatively recent or new product lines include</p>
<ul class="simple">
<li>Tridium Niagara, or its open version Sedona (<a class="reference external" href="http://www.sedonadev.org/">http://www.sedonadev.org/</a>),</li>
<li>Distech control (<a class="reference external" href="http://www.distech-controls.com/en/us/">http://www.distech-controls.com/en/us/</a>), and</li>
<li>Schneider Electric’s EcoStruxture (<a class="reference external" href="https://www.schneider-electric.us/en/work/campaign/innovation/overview.jsp">https://www.schneider-electric.us/en/work/campaign/innovation/overview.jsp</a>).</li>
</ul>
<p>While Sedona has been designed for 3rd party developers to add
new functionality, the others seem rather closed.
For example, detailed developer documentation that describes the following
is difficult to find, or may not exist:</p>
<ul class="simple">
<li>the language specification for implementation of block diagrams,</li>
<li>the model of computation, and</li>
<li>how to simulate open loop control responses and implement regression testing,</li>
</ul>
<p>Sedona “is designed to make it easy to build smart, networked embedded devices”
and Sedona attempts to create an “Open Source Ecosystem” (<a class="reference external" href="http://www.sedonadev.org/">http://www.sedonadev.org/</a>).
Block diagrams can be developed with the free
Sedona Application Editor (<a class="reference external" href="https://www.ccontrols.com/basautomation/sae.htm">https://www.ccontrols.com/basautomation/sae.htm</a>).</p>
</div>
<div class="section" id="use-of-control-sequences-or-verification-tests-in-realtime-applications">
<h2>8.2. Use of Control Sequences or Verification Tests in Realtime Applications<a class="headerlink" href="#use-of-control-sequences-or-verification-tests-in-realtime-applications" title="Permalink to this headline">¶</a></h2>
<p>Use of control sequences or verification tests in realtime applications, such
as in a building automation system or in a verification test module, consists
of the following steps:</p>
<ol class="arabic simple">
<li>Implementation of the control sequence or verification test as a Modelica model.</li>
<li>Export of the Modelica model as a <a class="reference internal" href="glossary.html#term-functional-mockup-unit"><span class="xref std std-term">Functional Mockup Unit</span></a> for Model Exchange (FMU-ME)
or as a JSON specification.</li>
<li>Import of the FMU-ME in the runtime environment, or translation of the
JSON specification to the language used by the building automation system.</li>
</ol>
<div class="figure" id="id3">
<span id="fig-cod-exp"></span><a class="reference internal image-reference" href="_images/codeExport.svg"><img alt="_images/codeExport.svg" src="_images/codeExport.svg" width="700px" /></a>
<p class="caption"><span class="caption-number">Fig. 8.1 </span><span class="caption-text">Overview of the code export and import of control sequences and verification
tests.</span></p>
</div>
<p><a class="reference internal" href="#fig-cod-exp"><span class="std std-numref">Fig. 8.1</span></a> shows the process of exporting and importing
control sequences or verification tests.</p>
<p>We will now describe three different approaches that can be used by control vendors
to translate CDL to their product line:</p>
<ol class="arabic simple">
<li>Export of the whole CDL-compliant sequence to one FMU (<a class="reference internal" href="#sec-cdl-to-fmi"><span class="std std-numref">Section 8.2.1</span></a>),</li>
<li>Translation of the CDL-compliant sequence to a JSON intermediate format, which can be translated
to the format used by the control platform (<a class="reference internal" href="#sec-cdl-to-json-simp"><span class="std std-numref">Section 8.2.2</span></a>), and</li>
<li>Translation of the CDL-compliant sequence to an xml-based standard called
System Structure and Parameterization (SSP), which
is then used to parameterize, link and execute pre-compiled elementary CDL blocks
(<a class="reference internal" href="#sec-cdl-ssp"><span class="std std-numref">Section 8.2.3</span></a>).</li>
</ol>
<p>The best approach will depend on the control platform.</p>
<div class="section" id="export-of-a-control-sequence-or-a-verification-test-using-the-fmi-standard">
<span id="sec-cdl-to-fmi"></span><h3>8.2.1. Export of a Control Sequence or a Verification Test using the FMI Standard<a class="headerlink" href="#export-of-a-control-sequence-or-a-verification-test-using-the-fmi-standard" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to export a control sequence, or a verification test,
using the <a class="reference internal" href="glossary.html#term-functional-mockup-interface"><span class="xref std std-term">FMI standard</span></a>.
In this workflow, the intermediate format
that is used is FMI for model exchange, as it is an open standard, and because FMI
can easily be integrated into tools for controls or verification
using a variety of languages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Also possible, but outside of the scope
of this project, is the translation of the control sequences to
JavaScript, which could then be executed in a building automation system.
For a Modelica to JavasScript converter,
see <a class="reference external" href="https://github.com/tshort/openmodelica-javascript">https://github.com/tshort/openmodelica-javascript</a>.</p>
</div>
<p>To implement control sequences, blocks from the
CDL library (<a class="reference internal" href="cdl.html#sec-ele-bui-blo"><span class="std std-numref">Section 7.4</span></a>) can be used to compose sequences that conform
to the CDL language specification described in <a class="reference internal" href="cdl.html#sec-cdl"><span class="std std-numref">Section 7</span></a>.
For verification tests, any Modelica block can be used.
Next, to export the Modelica model, a Modelica tool such as JModelica, OpenModelica
or Dymola can be used.
For example, with JModelica a control sequence can be exported using the Python commands</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymodelica</span> <span class="kn">import</span> <span class="n">compile_fmu</span>
<span class="n">compile_fmu</span><span class="p">(</span><span class="s2">&quot;Buildings.Controls.OBC.ASHRAE.G36_PR1.AHUs.SingleZone.Economizers.Controller&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will generate an FMU-ME.
Finally, to import the FMU-ME in a runtime environment, various tools can be used, including:</p>
<ul class="simple">
<li>Tools based on Python, which could be used to interface with
sMAP (<a class="reference external" href="https://pythonhosted.org/Smap/en/2.0/index.html">https://pythonhosted.org/Smap/en/2.0/index.html</a>) or
Volttron (<a class="reference external" href="https://energy.gov/eere/buildings/volttron">https://energy.gov/eere/buildings/volttron</a>):<ul>
<li>PyFMI (<a class="reference external" href="https://pypi.python.org/pypi/PyFMI">https://pypi.python.org/pypi/PyFMI</a>)</li>
</ul>
</li>
<li>Tools based on Java:<ul>
<li>Building Controls Virtual Test Bed (<a class="reference external" href="http://simulationresearch.lbl.gov/bcvtb">http://simulationresearch.lbl.gov/bcvtb</a>)</li>
<li>JFMI (<a class="reference external" href="https://ptolemy.eecs.berkeley.edu/java/jfmi/">https://ptolemy.eecs.berkeley.edu/java/jfmi/</a>)</li>
<li>JavaFMI (<a class="reference external" href="https://bitbucket.org/siani/javafmi/wiki/Home">https://bitbucket.org/siani/javafmi/wiki/Home</a>)</li>
</ul>
</li>
<li>Tools based on C:<ul>
<li>FMI Library (<a class="reference external" href="http://www.jmodelica.org/FMILibrary">http://www.jmodelica.org/FMILibrary</a>)</li>
</ul>
</li>
<li>Modelica tools, of which many if not all provide
functionality for real-time simulation:<ul>
<li>JModelica (<a class="reference external" href="http://www.jmodelica.org">http://www.jmodelica.org</a>)</li>
<li>OpenModelica (<a class="reference external" href="https://openmodelica.org/">https://openmodelica.org/</a>)</li>
<li>Dymola (<a class="reference external" href="https://www.3ds.com/products-services/catia/products/dymola/">https://www.3ds.com/products-services/catia/products/dymola/</a>)</li>
<li>MapleSim (<a class="reference external" href="https://www.maplesoft.com/products/maplesim/">https://www.maplesoft.com/products/maplesim/</a>)</li>
<li>SimulationX (<a class="reference external" href="https://www.simulationx.com/">https://www.simulationx.com/</a>)</li>
<li>SystemModeler (<a class="reference external" href="http://www.wolfram.com/system-modeler/index.html">http://www.wolfram.com/system-modeler/index.html</a>)</li>
</ul>
</li>
</ul>
<p>See also <a class="reference external" href="http://fmi-standard.org/tools/">http://fmi-standard.org/tools/</a> for other tools.</p>
<p>Note that directly compiling Modelica models to building automation systems
also allows leveraging the ongoing <a class="reference external" href="https://itea3.org/project/emphysis.html">EMPHYSIS</a>
project (2017-20, Euro 14M) that develops technologies
for running dynamic models on electronic control units (ECU),
micro controllers or other embedded systems.
This may be attractive for FDD and some advanced control sequences.</p>
</div>
<div class="section" id="translation-of-a-control-sequence-using-a-json-intermediate-format">
<span id="sec-cdl-to-json-simp"></span><h3>8.2.2. Translation of a Control Sequence using a JSON Intermediate Format<a class="headerlink" href="#translation-of-a-control-sequence-using-a-json-intermediate-format" title="Permalink to this headline">¶</a></h3>
<p>Control companies that choose to not use C-code generation or the FMI standard to
execute CDL-compliant control sequences can develop translators from
CDL to their native language. To aid in this process, a CDL to JSON translator
can be used. Such a translator is currently being developed at
<a class="reference external" href="https://github.com/lbl-srg/modelica-json">https://github.com/lbl-srg/modelica-json</a>.
This translator parses CDL-compliant control sequences to a JSON format.
The parser generates the following output formats:</p>
<ol class="arabic simple">
<li>A JSON representation of the control sequence,</li>
<li>a simplified version of this JSON representation, and</li>
<li>an html-formated documentation of the control sequence.</li>
</ol>
<p>To translate CDL-compliant control sequences to the language that is used
by the respective building automation system, the simplified JSON representation
is most suited.</p>
<p>As an illustrative example, consider the composite control block shown in
<a class="reference internal" href="#fig-exp-custom-control-block"><span class="std std-numref">Fig. 8.2</span></a>.</p>
<div class="figure" id="id4">
<span id="fig-exp-custom-control-block"></span><a class="reference internal image-reference" href="_images/CustomPWithLimiter1.svg"><img alt="_images/CustomPWithLimiter1.svg" src="_images/CustomPWithLimiter1.svg" width="500px" /></a>
<p class="caption"><span class="caption-number">Fig. 8.2 </span><span class="caption-text">Example of a composite control block that outputs <span class="math notranslate nohighlight">\(y = \max( k \, e, \, y_{max})\)</span>
where <span class="math notranslate nohighlight">\(k\)</span> is a parameter.</span></p>
</div>
<p>In CDL, this would be specified as</p>
<div class="highlight-modelica notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">block</span> <span class="nc">CustomPWithLimiter</span>
  <span class="s2">&quot;Custom implementation of a P controller with variable output limiter&quot;</span>
  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">k</span> <span class="s2">&quot;Constant gain&quot;</span><span class="p">;</span>
  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">yMax</span> <span class="s2">&quot;Maximum value of output signal&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span><span class="mi">20</span><span class="p">},{</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">60</span><span class="p">}})));</span>
  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">e</span> <span class="s2">&quot;Control error&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">},{</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">}})));</span>
  <span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">y</span> <span class="s2">&quot;Control signal&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="mi">120</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>
  <span class="n">CDL</span><span class="o">.</span><span class="n">Continuous</span><span class="o">.</span><span class="n">Gain</span> <span class="n">gain</span><span class="p">(</span><span class="kr">final</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="s2">&quot;Constant gain&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="o">-</span><span class="mi">50</span><span class="p">},{</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">}})));</span>
  <span class="n">CDL</span><span class="o">.</span><span class="n">Continuous</span><span class="o">.</span><span class="n">Min</span> <span class="n">minValue</span> <span class="s2">&quot;Outputs the minimum of its inputs&quot;</span>
    <span class="kr">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="mi">40</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>
<span class="kr">equation</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">yMax</span><span class="p">,</span> <span class="n">minValue</span><span class="o">.</span><span class="n">u1</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">},{</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">}},</span> <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">gain</span><span class="o">.</span><span class="n">u</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">92</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">62</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">}},</span> <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">gain</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">minValue</span><span class="o">.</span><span class="n">u2</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">39</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">},{</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="mi">18</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">}},</span> <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">connect</span><span class="p">(</span><span class="n">minValue</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="kr">annotation</span> <span class="p">(</span>
     <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">{{</span><span class="mi">41</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">110</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span> <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">}));</span>
  <span class="kr">annotation</span> <span class="p">(</span><span class="n">Documentation</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="s2">&quot;</span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
Block that outputs <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>y = min(yMax, k*e)<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>,
where
<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>yMax<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> and <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>e<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> are real-valued input signals and
<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>k<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> is a parameter.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span><span class="s2">&quot;</span><span class="p">));</span>
<span class="kr">end</span> <span class="nc">CustomPWithLimiter</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>This specification can be converted to JSON using the program
<a class="reference external" href="https://github.com/lbl-srg/modelica-json">modelica-json</a>.
Executing the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node modelica-json/app.js -f CustomPWithLimiter.mo -o json-simplified
</pre></div>
</div>
<p>will produce a file called <code class="docutils literal notranslate"><span class="pre">CustomPWithLimiter-simplified.json</span></code> that
looks as follows:</p>
<div class="highlight-json notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;modelicaFile&quot;</span><span class="p">:</span> <span class="s2">&quot;CustomPWithLimiter.mo&quot;</span><span class="p">,</span>
    <span class="nt">&quot;topClassName&quot;</span><span class="p">:</span> <span class="s2">&quot;CustomPWithLimiter&quot;</span><span class="p">,</span>
    <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom implementation of a P controller with variable output limiter&quot;</span><span class="p">,</span>
    <span class="nt">&quot;public&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;Real&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Constant gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;annotation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;dialog&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;tab&quot;</span><span class="p">:</span> <span class="s2">&quot;General&quot;</span><span class="p">,</span>
              <span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;Parameters&quot;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;models&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;CDL.Interfaces.RealInput&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;yMax&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum value of output signal&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;CDL.Interfaces.RealInput&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Control error&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;CDL.Interfaces.RealOutput&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Control signal&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;CDL.Continuous.Gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Constant gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;modifications&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
              <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
              <span class="nt">&quot;isFinal&quot;</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;className&quot;</span><span class="p">:</span> <span class="s2">&quot;CDL.Continuous.Min&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;minValue&quot;</span><span class="p">,</span>
          <span class="nt">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Outputs the minimum of its inputs&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;html&gt;\n&lt;p&gt;\nBlock that outputs &lt;code&gt;y = min(yMax, k*e)&lt;/code&gt;,\nwhere\n&lt;code&gt;yMax&lt;/code&gt; and &lt;code&gt;e&lt;/code&gt; are real-valued input signals and\n&lt;code&gt;k&lt;/code&gt; is a parameter.\n&lt;/p&gt;\n&lt;/html&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;connections&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;yMax&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;minValue&quot;</span><span class="p">,</span>
          <span class="nt">&quot;connector&quot;</span><span class="p">:</span> <span class="s2">&quot;u1&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;connector&quot;</span><span class="p">:</span> <span class="s2">&quot;u&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;gain&quot;</span><span class="p">,</span>
          <span class="nt">&quot;connector&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;minValue&quot;</span><span class="p">,</span>
          <span class="nt">&quot;connector&quot;</span><span class="p">:</span> <span class="s2">&quot;u2&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;minValue&quot;</span><span class="p">,</span>
          <span class="nt">&quot;connector&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>Note that the graphical annotations are not shown.
The JSON representation can then be parsed and converted to another block-diagram
language.
Note that <code class="docutils literal notranslate"><span class="pre">CDL.Continuous.Gain</span></code> is an elementary CDL block
(see <a class="reference internal" href="cdl.html#sec-ele-bui-blo"><span class="std std-numref">Section 7.4</span></a>).
If it were a
composite CDL block (see <a class="reference internal" href="cdl.html#sec-com-blo"><span class="std std-numref">Section 7.10</span></a>), it would be parsed recursively
until only elementary CDL blocks are present in the JSON file.
Various examples of CDL converted to JSON can be found at
<a class="reference external" href="https://github.com/lbl-srg/modelica-json/tree/master/test/FromModelica">https://github.com/lbl-srg/modelica-json/tree/master/test/FromModelica</a>.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add a JSON-schema definition for the simplified JSON representation,
see <a class="reference external" href="http://json-schema.org">http://json-schema.org</a>.</p>
</div>
</div>
<div class="section" id="modular-export-of-a-control-sequence-using-the-fmi-standard-for-control-blocks-and-using-the-ssp-standard-for-the-run-time-environment">
<span id="sec-cdl-ssp"></span><h3>8.2.3. Modular Export of a Control Sequence using the FMI Standard for Control Blocks and using the SSP Standard for the Run-time Environment<a class="headerlink" href="#modular-export-of-a-control-sequence-using-the-fmi-standard-for-control-blocks-and-using-the-ssp-standard-for-the-run-time-environment" title="Permalink to this headline">¶</a></h3>
<p>In early 2018, a new standard called System Structure and Parameterization (SSP)
will be released. The standard provides an xml scheme for the
specification of FMU parameter values, their input and output connections,
and their graphical layout. The SSP standard allows
for transporting complex networks of FMUs between different platforms for
simulation, hardware-in-the-loop and model-in-the-loop <a class="reference internal" href="bibliography.html#koehleretal2016-1" id="id1">[KohlerHM+16]</a>.
Various tools that can simulate systems specified using the SSP standard
are in development, with
FMI composer (<a class="reference external" href="http://www.modelon.com/products/modelon-deployment-suite/fmi-composer/">http://www.modelon.com/products/modelon-deployment-suite/fmi-composer/</a>)
from Modelon being commercially available.</p>
<p>CDL-compliant control sequences could be exported to the SSP standard as shown
in <a class="reference internal" href="#fig-cdl-ssp"><span class="std std-numref">Fig. 8.3</span></a>.</p>
<div class="figure" id="id5">
<span id="fig-cdl-ssp"></span><p class="plantuml">
<object data="_images/plantuml-fe4b117a8045a59d5f331a97e0858a2e2523131c.svg" type="image/svg+xml" style="width:444px;height:145px;">
<a href="_images/plantuml-fe4b117a8045a59d5f331a97e0858a2e2523131c.png"><img src="_images/plantuml-fe4b117a8045a59d5f331a97e0858a2e2523131c.png" alt="skinparam componentStyle uml2

scale 450 width

  database &quot;CDL library&quot; as cdl_lib {
  }
  database &quot;FMU repository&quot; as fmu_lib {
  }

  cdl_lib -r-&gt; fmu_lib: generate

  [CDL-compliant\nsequence]

  [JSON-simplified\nrepresentation]

  [CDL-compliant\nsequence] -r-&gt; [JSON-simplified\nrepresentation] : translate

  [JSON-simplified\nrepresentation] -r-&gt; [SSP-compliant\nspecification] : translate

  fmu_lib -&gt; [FMI Composer] : uses

  [SSP-compliant\nspecification] -d-&gt; [FMI Composer] : import" style="width: 550px"/></a>

</object></p>
<p class="caption"><span class="caption-number">Fig. 8.3 </span><span class="caption-text">Translation of CDL to SSP.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>In such a workflow, a control vendor would translate the elementary CDL blocks
(<a class="reference internal" href="cdl.html#sec-ele-bui-blo"><span class="std std-numref">Section 7.4</span></a>)
to a repository of FMU-ME blocks. These blocks will then be used during operation.
For each project, its CDL-compliant control sequence could be translated
to the simplified JSON format, as described in <a class="reference internal" href="#sec-cdl-to-json-simp"><span class="std std-numref">Section 8.2.2</span></a>.
Using a template engine (similar as is used
by <code class="docutils literal notranslate"><span class="pre">modelica-json</span></code> to translate the simplified JSON to html),
the simplified JSON representation could then be converted to the xml syntax
specified in the SSP standard.
Finally, a tool such as the FMI Composer could import the
SSP-compliant specification, and execute the control sequence using
the elementary CDL block FMUs from the FMU repository.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this workflow, all key representations are based on standards:
The CDL-specification uses a subset of the Modelica standard,
the elementary CDL blocks are converted to the FMI standard,
and finally the runtime environment uses the SSP standard.</p>
</div>
</div>
</div>
<div class="section" id="replacement-of-elementary-cdl-blocks-during-translation">
<h2>8.3. Replacement of Elementary CDL Blocks during Translation<a class="headerlink" href="#replacement-of-elementary-cdl-blocks-during-translation" title="Permalink to this headline">¶</a></h2>
<p>When translating CDL to a control product lines, a translator may want to
conduct certain substitutions. Some of these substitutions can change the
control response, which can cause the verification that checks whether the
actual implementation conforms to the specification to fail.</p>
<p>This section therefore explains how certain substitutions can be performed
in a way that allows formal verification to pass.
(How verification tests will be conducted will be specified later in 2018, but
essentially we will require that the control response from the actual control
implementation is within a certain tolerance of the control response
computed by the CDL specification, provided that both sequences receive
the same input signals and use the same parameter values.)</p>
<div class="section" id="substitutions-that-give-identical-control-response">
<h3>8.3.1. Substitutions that Give Identical Control Response<a class="headerlink" href="#substitutions-that-give-identical-control-response" title="Permalink to this headline">¶</a></h3>
<p>Consider the gain <code class="docutils literal notranslate"><span class="pre">CDL.Continuous.Gain</span></code> used above. If a product line
uses different names for the inputs, outputs and parameters, then they can
be replaced.</p>
<p>Moreover, certain transformations that do not change the
response of the block are permissible: For example, consider the
<a class="reference external" href="http://simulationresearch.lbl.gov/modelica/releases/v5.0.1/help/Buildings_Controls_OBC_CDL_Continuous.html#Buildings.Controls.OBC.CDL.Continuous.LimPID">PID controller in the CDL library</a>.
The implementation has a parameter
for the time constant of the integrator block.
If a control vendor requires the specification of an integrator gain rather than
the integrator time constant, then such a parameter transformation can be done during
the translation, as both implementations yield an identical response.</p>
</div>
<div class="section" id="substitutions-that-change-the-control-response">
<span id="sec-cha-sub-cha"></span><h3>8.3.2. Substitutions that Change the Control Response<a class="headerlink" href="#substitutions-that-change-the-control-response" title="Permalink to this headline">¶</a></h3>
<p>If a control vendor likes to use for example a different implementation of
the anti-windup in a PID controller, then such a substitution
will cause the verification to fail if the control responses differ
between the CDL-compliant specification and the vendor’s implementation.</p>
<p>Therefore, if a customer requires the implemented control sequence to comply
with the specification, then the workflow shall be such that
the control provider provides an executable implementation of its controller,
and the control provider shall ask the customer to replace
in the control specification the PID controller from the CDL library with the PID controller
provided by the control provider. Afterwards, verification can be conducted as usual.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Such an executable implementation of a vendor’s PID controller can
be made available by publishing the controller
or by contributing the controller to the Modelica Buildings Library.
The implementation of the control logic can be done either
using other <code class="docutils literal notranslate"><span class="pre">CDL</span></code> blocks, which is the preferred approach,
using the C language, or by providing
a compiled library. See the Modelica Specification <a class="reference internal" href="bibliography.html#modelica2012-1" id="id2">[Mod12]</a>
for implementation details
if C code or compiled libraries are provided.
If a compiled library is provided, then binaries shall be provided for
Windows 32/64 bit, Linux 32/64 bit, and OS X 64 bit.</p>
</div>
</div>
<div class="section" id="adding-blocks-that-are-not-in-the-cdl-library">
<h3>8.3.3. Adding Blocks that are not in the CDL Library<a class="headerlink" href="#adding-blocks-that-are-not-in-the-cdl-library" title="Permalink to this headline">¶</a></h3>
<p>If a control vendor likes to use a block that is not in the CDL library,
such as a block that uses machine learning to schedule optimal warm-up,
then such an addition must be approved by the customer.
If the customer requires the part of the control sequence that contains this
block to be verified, then the block shall be made available as described in <a class="reference internal" href="#sec-cha-sub-cha"><span class="std std-numref">Section 8.3.2</span></a>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.<br/>
    </p>
  </div>
</footer>

  </body>
</html>